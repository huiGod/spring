# BeanFactoryPostProcessor后置处理器

BeanFactoryPostProcessor是spring的另一个扩展点，作用在bean加载完成后，实例化bean对象之前来执行，此时可以覆盖和添加bean的一些属性。并且可以配置多个BeanFactoryPostProcessor，通过order属性来控制各个BeanFactoryPostProcessor的执行次序

```java
@FunctionalInterface
public interface BeanFactoryPostProcessor {

	/**
	 * Modify the application context's internal bean factory after its standard
	 * initialization. All bean definitions will have been loaded, but no beans
	 * will have been instantiated yet. This allows for overriding or adding
	 * properties even to eager-initializing beans.
	 * @param beanFactory the bean factory used by the application context
	 * @throws org.springframework.beans.BeansException in case of errors
	 */
	void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;

}
```

# BeanDefinitionRegistryPostProcessor后置处理器

对BeanFactoryPostProcessor接口的扩展

```java
public interface BeanDefinitionRegistryPostProcessor extends BeanFactoryPostProcessor {

	/**
	 * Modify the application context's internal bean definition registry after its
	 * standard initialization. All regular bean definitions will have been loaded,
	 * but no beans will have been instantiated yet. This allows for adding further
	 * bean definitions before the next post-processing phase kicks in.
	 * @param registry the bean definition registry used by the application context
	 * @throws org.springframework.beans.BeansException in case of errors
	 */
	void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException;

}
```

# ConfigurationClassPostProcessor解析@Configuration处理器

ConfigurationClassPostProcessor是默认的后置处理器，在容器启动时会注入进来，用来解析@Configuration相关的bean，非常重要，所以执行顺序的优先级非常高

![ConfigurationClassPostProcessor](D:\user\文档\cl\doc\spring\3.BeanFactoryPostProcessor后置处理器.assets\ConfigurationClassPostProcessor.jpg)

```java
public class ConfigurationClassPostProcessor implements BeanDefinitionRegistryPostProcessor,
		PriorityOrdered, ResourceLoaderAware, BeanClassLoaderAware, EnvironmentAware {
            ...
}
```

在容器启动时，会优先执行该对象的postProcessBeanDefinitionRegistry方法

```java
@Override
public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) {
    int registryId = System.identityHashCode(registry);
    if (this.registriesPostProcessed.contains(registryId)) {
        throw new IllegalStateException(
            "postProcessBeanDefinitionRegistry already called on this post-processor against " + registry);
    }
    if (this.factoriesPostProcessed.contains(registryId)) {
        throw new IllegalStateException(
            "postProcessBeanFactory already called on this post-processor against " + registry);
    }
    this.registriesPostProcessed.add(registryId);

    processConfigBeanDefinitions(registry);
}
```

